<h1>Log in</h1>

<% if flash[:notice] %>
  <p style="color: green;"><%= flash[:notice] %></p>
<% elsif flash[:alert] %>
  <p style="color: red;"><%= flash[:alert] %></p>
<% end %>

<%= form_with url: login_path, local: true do %>
  <div>
    <%= label_tag :email, "Email" %><br>
    <%= text_field_tag :email, params[:email] %>
  </div>
  <div>
    <%= label_tag :password, "Password" %><br>
    <%= password_field_tag :password %>
  </div>
  <div>
    <%= submit_tag "Log in" %>
  </div>
<% end %>

<p>Don't have an account? <%= link_to "Sign up", signup_path %></p>

<%# Inject request + response into the browser console for debugging %>
<% if params[:email].present? || params[:password].present? %>
  <script>
    console.log("Supabase login payload:", {
      email: "<%= params[:email].to_s %>",
      password: "<%= params[:password].to_s %>"
    });
  </script>
<% end %>

<% if @supabase_response_json.present? %>
  <script>
    console.log("Supabase login response:", <%= raw @supabase_response_json %>);
  </script>
<% end %>
